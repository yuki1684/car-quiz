<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supercar Quiz v11.0</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>ğŸï¸ Supercar Quiz v11</h1>

    <div id="start-screen" class="card">
        <h2>GAME SETUP</h2>
        <div class="mode-group">
            <span style="color:#aaa; display:block; margin-bottom:5px;">1. ã‚¯ã‚¤ã‚ºã®ç¨®é¡</span>
            <div class="selection-grid">
                <button class="select-btn" id="btn-cat-image" onclick="selectCategory('image')">ğŸ“· ç”»åƒã‚¯ã‚¤ã‚º</button>
                <button class="select-btn" id="btn-cat-sound" onclick="selectCategory('sound')">ğŸ”Š éŸ³ã‚¯ã‚¤ã‚º + ğŸ¥</button>
            </div>
        </div>
        <div class="mode-group">
            <span style="color:#aaa; display:block; margin-bottom:5px;">2. ãƒ¢ãƒ¼ãƒ‰é¸æŠ</span>
            <div class="selection-grid">
                <button class="select-btn" id="btn-mode-time" onclick="selectMode(true)">ğŸ”¥ ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯</button>
                <button class="select-btn" id="btn-mode-relax" onclick="selectMode(false)">â˜• ãƒªãƒ©ãƒƒã‚¯ã‚¹</button>
            </div>
        </div>
        <button id="start-btn" class="big-start-btn" onclick="startGame()" disabled>START GAME</button>
    </div>

    <div id="game-screen">
        <div class="game-header">
            <span id="progress-text">Q 1 / 10</span>
            <div class="header-right">
                <span style="color:#f1c40f; font-weight:bold;">SCORE: <span id="score">0</span></span>
                <button class="menu-btn" onclick="backToMenu()">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
            </div>
        </div>
        
        <div id="timer-wrapper" style="margin-top:5px; display:none;">
            <div style="background:#333; height:8px; border-radius:4px; overflow:hidden;">
                <div id="timer-bar" class="timer-bar"></div>
            </div>
            <div style="text-align:right; font-size:0.8em; color:#aaa; margin-top:2px;">æ®‹ã‚Š <span id="time-left">10</span> ç§’</div>
        </div>
        <div id="quiz-area" class="card"></div>
    </div>

    <div id="final-screen" class="card">
        <h2>ğŸ FINISH! ğŸ</h2>
        <div style="font-size:4em; color:#f1c40f; margin:20px 0;" id="final-score">0</div>
        <p id="rank-comment" style="font-size:1.2em; font-weight:bold;"></p>
        <button class="btn" style="background:#3498db; margin-top:20px;" onclick="location.reload()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>

    <script>
        // ==========================================
        // ğŸµ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª & åŠ¹æœéŸ³ã‚·ã‚¹ãƒ†ãƒ 
        // ==========================================
        let currentAudio = null; 
        
        function playEngineSound(fileName) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            if (!fileName) return;

            currentAudio = new Audio(fileName);
            currentAudio.play().catch(e => {
                console.log("éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e);
            });

            const icon = document.getElementById('sound-icon');
            if(icon) {
                icon.classList.add('sound-playing');
                currentAudio.onended = () => {
                    icon.classList.remove('sound-playing');
                };
            }
        }

        function stopEngineSound() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            const icon = document.getElementById('sound-icon');
            if(icon) icon.classList.remove('sound-playing');
        }

        let audioCtx;
        function playSE(type) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const now = audioCtx.currentTime;
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(880, now); osc.frequency.setValueAtTime(1760, now + 0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.3);
            } else {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.3);
            }
            osc.start(now); osc.stop(now + 0.3); osc.connect(gain); gain.connect(audioCtx.destination);
        }

        // ==========================================
        // ğŸ® ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
        // ==========================================
        let selectedCategory = null; 
        let isTimerMode = null;      
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let timerInterval;
        let timeLeft = 10;
        let isAnswered = false;

        function selectCategory(cat) {
            selectedCategory = cat;
            document.getElementById('btn-cat-image').classList.remove('selected');
            document.getElementById('btn-cat-sound').classList.remove('selected');
            document.getElementById(`btn-cat-${cat}`).classList.add('selected');
            checkStartReady();
        }
        function selectMode(mode) {
            isTimerMode = mode;
            document.getElementById('btn-mode-time').classList.remove('selected');
            document.getElementById('btn-mode-relax').classList.remove('selected');
            document.getElementById(mode ? 'btn-mode-time' : 'btn-mode-relax').classList.add('selected');
            checkStartReady();
        }
        function checkStartReady() {
            if (selectedCategory && isTimerMode !== null) document.getElementById('start-btn').disabled = false;
        }

        function startGame() {
            if (selectedCategory === 'image') currentQuestions = [...imageQuizzes];
            else currentQuestions = [...soundQuizzes];
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            if (isTimerMode) document.getElementById('timer-wrapper').style.display = 'block';
            loadQuestion();
        }
    function backToMenu() {
            location.reload();}

        function loadQuestion() {
            isAnswered = false;
            stopEngineSound();

            const q = currentQuestions[currentIndex];
            document.getElementById('progress-text').innerText = `Q ${currentIndex + 1} / ${currentQuestions.length}`;
            
            let mediaHTML = '';
            if (selectedCategory === 'image') {
                mediaHTML = `<div class="image-container"><img id="zoom-target" src="${q.img}" class="zoom-img"></div>`;
            } else {
                mediaHTML = `<div id="sound-area" class="sound-container"><div class="sound-icon" id="sound-icon" onclick="playEngineSound('${q.soundFile}')">ğŸ”Š</div><p style="color:#aaa; font-size:0.9em; margin-top:10px;">ã‚¯ãƒªãƒƒã‚¯ã§å†ç”Ÿ / å†ç”Ÿä¸­...</p></div><div id="video-area" class="video-wrapper"></div>`;
            }

            let buttonsHTML = '<div class="options-grid">';
            q.o.forEach((opt, idx) => {
                buttonsHTML += `<button class="btn option-btn" onclick="checkAnswer(${idx}, this)">${opt}</button>`;
            });
            buttonsHTML += '</div>';

            document.getElementById('quiz-area').innerHTML = `<h2 style="margin:0 0 10px 0;">${q.q}</h2>${mediaHTML}${buttonsHTML}<div id="result-msg" style="min-height:30px; margin-top:15px; font-weight:bold;"></div><button id="next-btn" class="btn" style="background:#3498db; margin-top:10px; display:none;" onclick="goNext()">æ¬¡ã®å•é¡Œã¸ â¡</button>`;

            setTimeout(() => {
                if(selectedCategory === 'image') {
                    const img = document.getElementById('zoom-target');
                    if(img) img.style.transform = "scale(1)";
                } else {
                    playEngineSound(q.soundFile);
                }
            }, 800);

            if (isTimerMode) startTimer();
        }

        function startTimer() {
            timeLeft = 10;
            updateTimerUI();
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerUI();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerUI() {
            document.getElementById('time-left').innerText = timeLeft;
            document.getElementById('timer-bar').style.width = (timeLeft * 10) + "%";
        }

        function timeUp() {
            if(isAnswered) return;
            checkAnswer(-1, null);
        }

        function checkAnswer(idx, btn) {
            if (isAnswered) return;
            isAnswered = true;
            clearInterval(timerInterval);
            
            stopEngineSound();

            const q = currentQuestions[currentIndex];
            const allBtns = document.querySelectorAll('.option-btn');
            const resultMsg = document.getElementById('result-msg');
            const imgContainer = document.querySelector('.image-container');

            if(selectedCategory === 'image') {
                const img = document.getElementById('zoom-target');
                if(img) img.style.transform = "scale(1)";
            }
            if(selectedCategory === 'sound') {
                const soundArea = document.getElementById('sound-area');
                const videoArea = document.getElementById('video-area');
                soundArea.style.display = 'none';
                videoArea.style.display = 'block';
                videoArea.innerHTML = `<iframe src="https://www.youtube.com/embed/${q.video}?autoplay=1&mute=1&controls=0&rel=0" allow="autoplay"></iframe>`;
            }

            let isCorrect = (idx === q.a);
            if (isCorrect) {
                playSE('correct');
                let points = 100;
                if (isTimerMode) points += (timeLeft * 10);
                score += points;
                resultMsg.innerHTML = `<span style="color:#2ecc71">æ­£è§£ï¼ +${points}ç‚¹</span>`;
                btn.classList.add('correct-btn');
                if(imgContainer) imgContainer.classList.add('border-correct');
            } else {
                playSE('wrong');
                resultMsg.innerHTML = `<span style="color:#e74c3c">ä¸æ­£è§£... æ­£è§£ã¯ã€Œ${q.o[q.a]}ã€</span>`;
                if(btn) btn.classList.add('wrong-btn');
                if(imgContainer) imgContainer.classList.add('border-wrong');
                allBtns[q.a].classList.add('correct-btn');
            }
            document.getElementById('score').innerText = score;
            allBtns.forEach(b => b.disabled = true);
            document.getElementById('next-btn').style.display = 'block';
        }

        function goNext() {
            currentIndex++;
            if (currentIndex < currentQuestions.length) loadQuestion();
            else showResult();
        }

        function showResult() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;
            const maxScore = currentQuestions.length * (isTimerMode ? 200 : 100);
            const rank = document.getElementById('rank-comment');
            if (score >= maxScore * 0.8) {
                rank.innerText = "ğŸ† ç©¶æ¥µã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼ãƒã‚¤ã‚¹ã‚¿ãƒ¼ï¼"; rank.style.color = "#f1c40f"; playSE('correct');
            } else if (score >= maxScore * 0.5) {
                rank.innerText = "ğŸš— ç«‹æ´¾ãªè»Šå¥½ãã§ã™ã­ï¼"; rank.style.color = "#2ecc71";
            } else {
                rank.innerText = "ğŸ”° ã¾ã ã¾ã ã“ã‚Œã‹ã‚‰ï¼"; rank.style.color = "#fff";
            }
        }

        // ==========================================
        // ğŸ’¾ ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ
        // ==========================================
        
        // ğŸ“· ã€ç”»åƒã‚¯ã‚¤ã‚ºã€‘(PNG, JPGå¯¾å¿œ)
        const imageQuizzes = [
            { a:0, q:"ã“ã®è»Šã¯ï¼Ÿ", img:"https://images.unsplash.com/photo-1592198084033-aade902d1aae?w=600", o:["ãƒ•ã‚§ãƒ©ãƒ¼ãƒª F8", "ãƒã‚¯ãƒ©ãƒ¼ãƒ¬ãƒ³ 720S", "ãƒ©ãƒ³ãƒœãƒ«ã‚®ãƒ¼ãƒ‹", "ãƒãƒ«ã‚·ã‚§ 911"] },
            { a:1, q:"å·¨å¤§ãªãƒªã‚¢ã‚¦ã‚£ãƒ³ã‚°...", img:"https://images.unsplash.com/photo-1503376763036-066120622c74?w=600", o:["GT-R Nismo", "ãƒãƒ«ã‚·ã‚§ 911 GT3", "ãƒ›ãƒ³ãƒ€ NSX", "BMW M4"] },
            { a:2, q:"é‹­ã„ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒˆ", img:"https://images.unsplash.com/photo-1544605975-33d886f8b542?w=600", o:["ã‚«ãƒãƒ­", "ãƒã‚¹ã‚¿ãƒ³ã‚°", "ãƒ©ãƒ³ãƒœãƒ«ã‚®ãƒ¼ãƒ‹ ã‚¦ãƒ©ã‚«ãƒ³", "ã‚³ãƒ«ãƒ™ãƒƒãƒˆ"] },
            { a:0, q:"ä¼èª¬ã®ãƒã‚¤ãƒ‘ãƒ¼ã‚«ãƒ¼", img:"https://images.unsplash.com/photo-1621508654686-8193a7d43232?w=600", o:["ãƒ–ã‚¬ãƒƒãƒ†ã‚£ ã‚·ãƒ­ãƒ³", "ã‚±ãƒ¼ãƒ‹ã‚°ã‚»ã‚°", "ãƒ‘ã‚¬ãƒ¼ãƒ‹", "ãƒ©ãƒ»ãƒ•ã‚§ãƒ©ãƒ¼ãƒª"] },
            { a:3, q:"ãƒªãƒˆãƒ©ã‚¯ã‚¿ãƒ–ãƒ«ãƒ©ã‚¤ãƒˆ", img:"https://images.unsplash.com/photo-1552519507-da8b1227ad4a?w=600", o:["AE86", "RX-7 (FD)", "ã‚¹ãƒ¼ãƒ—ãƒ©", "NSX (åˆä»£)"] },
            { a:1, q:"ã‚¤ã‚®ãƒªã‚¹ã®èª‡ã‚Š", img:"https://images.unsplash.com/photo-1617788138017-80ad40651399?w=600", o:["ãƒ™ãƒ³ãƒˆãƒ¬ãƒ¼", "ã‚¢ã‚¹ãƒˆãƒ³ãƒãƒ¼ãƒ†ã‚£ãƒ³", "ã‚¸ãƒ£ã‚¬ãƒ¼", "ãƒ­ãƒ¼ã‚¿ã‚¹"] },
            { a:2, q:"å›½ç”£ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼", img:"https://images.unsplash.com/photo-1627454819213-17742d4a51e6?w=600", o:["LC500", "LFA", "GT-R (R35)", "NSX"] },
            { a:0, q:"ã‚¬ãƒ«ã‚¦ã‚£ãƒ³ã‚°ãƒ‰ã‚¢", img:"https://images.unsplash.com/photo-1614200187524-dc4b392ade73?w=600", o:["ãƒ¡ãƒ«ã‚»ãƒ‡ã‚¹ SLS AMG", "ãƒ‡ãƒ­ãƒªã‚¢ãƒ³", "ãƒ†ã‚¹ãƒ©", "ãƒ‘ã‚¬ãƒ¼ãƒ‹"] },
            { a:3, q:"V10ã‚¨ãƒ³ã‚¸ãƒ³ã®å‚‘ä½œ", img:"https://images.unsplash.com/photo-1600712242805-5f78671b24da?w=600", o:["ãƒ•ã‚§ãƒ©ãƒ¼ãƒª 458", "BMW M5", "ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼", "ãƒ¬ã‚¯ã‚µã‚¹ LFA"] },
            { a:1, q:"ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒãƒƒã‚¹ãƒ«", img:"https://images.unsplash.com/photo-1583121274602-3e2820c698d9?w=600", o:["ã‚«ãƒãƒ­", "ãƒ•ã‚©ãƒ¼ãƒ‰ GT", "ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼", "ã‚³ãƒ«ãƒ™ãƒƒãƒˆ"] }
        ];

        // ğŸ”Š ã€éŸ³ã‚¯ã‚¤ã‚ºã€‘(MP3å¯¾å¿œ)
        const soundQuizzes = [
            { a:1, q:"ã“ã®é«˜éŸ³V12ã‚µã‚¦ãƒ³ãƒ‰ã¯ï¼Ÿ", soundFile:"sound_aventador.mp3", video:"mk40W31d92A", o:["ãƒ€ãƒƒã‚¸ ãƒã‚¤ãƒ‘ãƒ¼", "ãƒ©ãƒ³ãƒœãƒ«ã‚®ãƒ¼ãƒ‹ ã‚¢ãƒ´ã‚§ãƒ³ã‚¿ãƒ‰ãƒ¼ãƒ«", "AMG GT", "ã‚³ãƒ«ãƒ™ãƒƒãƒˆ"] },
            { a:0, q:"ç‹¬ç‰¹ãªä¹¾ã„ãŸV8ã‚µã‚¦ãƒ³ãƒ‰", soundFile:"sound_ferrari458.mp3", video:"K9O1T0jG1tQ", o:["ãƒ•ã‚§ãƒ©ãƒ¼ãƒª 458", "ãƒã‚¹ã‚¿ãƒ³ã‚°", "ã‚¢ã‚¹ãƒˆãƒ³ãƒãƒ¼ãƒ†ã‚£ãƒ³", "ãƒ™ãƒ³ãƒˆãƒ¬ãƒ¼"] },
            { a:3, q:"ãƒ‰ãƒ­ãƒ‰ãƒ­ã¨ã—ãŸä½éŸ³...", soundFile:"sound_challenger.mp3", video:"Q6Mdc5fP-jM", o:["ãƒãƒ«ã‚·ã‚§ 911", "NSX", "GT-R", "ãƒ€ãƒƒã‚¸ ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼"] },
            { a:2, q:"ç²¾å¯†æ©Ÿæ¢°ã®ã‚ˆã†ãªç›´6éŸ³", soundFile:"sound_bmw.mp3", video:"A_1Xo3e6-e4", o:["ã‚¹ãƒ¼ãƒ—ãƒ©", "RX-7", "BMW M4", "ã‚·ãƒ“ãƒƒã‚¯ TypeR"] },
            { a:0, q:"F1ã®ã‚ˆã†ãªè¶…é«˜éŸ³ (V10)", soundFile:"sound_lfa.mp3", video:"p6D7jI-O9sg", o:["ãƒ¬ã‚¯ã‚µã‚¹ LFA", "ã‚¢ã‚¦ãƒ‡ã‚£ R8", "ã‚¬ãƒ¤ãƒ«ãƒ‰", "ã‚¦ãƒ©ã‚«ãƒ³"] },
            { a:1, q:"ãƒ­ãƒ¼ã‚¿ãƒªãƒ¼ã‚µã‚¦ãƒ³ãƒ‰", soundFile:"sound_rx7.mp3", video:"v4aL0R2K6m8", o:["GT-R", "ãƒãƒ„ãƒ€ RX-7", "ãƒ©ãƒ³ã‚¨ãƒœ", "ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚µ"] },
            { a:2, q:"æ°´å¹³å¯¾å‘ã‚¨ãƒ³ã‚¸ãƒ³ã®é¼“å‹•", soundFile:"sound_boxer.mp3", video:"C629555555", o:["86/BRZ", "ãƒ•ã‚§ãƒ©ãƒ¼ãƒª", "ãƒãƒ«ã‚·ã‚§ 911", "WRX STI"] },
            { a:3, q:"W16ã‚¨ãƒ³ã‚¸ãƒ³ã®é‡ä½éŸ³", soundFile:"sound_chiron.mp3", video:"PkkV1vLHUvQ", o:["ãƒ­ãƒ¼ãƒ«ã‚¹ãƒ­ã‚¤ã‚¹", "ãƒã‚¤ãƒãƒƒãƒ", "ã‚±ãƒ¼ãƒ‹ã‚°ã‚»ã‚°", "ãƒ–ã‚¬ãƒƒãƒ†ã‚£ ã‚·ãƒ­ãƒ³"] },
            { a:0, q:"ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ã‚¿ãƒ¼æ··ã˜ã‚Š", soundFile:"sound_nsx.mp3", video:"gP94d55555", o:["ãƒ›ãƒ³ãƒ€ NSX(æ–°å‹)", "ãƒ—ãƒªã‚¦ã‚¹", "i8", "ãƒ©ãƒ»ãƒ•ã‚§ãƒ©ãƒ¼ãƒª"] },
            { a:1, q:"ã‚¢ãƒ¡ãƒªã‚«ãƒ³V8ã®çˆ†éŸ³", soundFile:"sound_mustang.mp3", video:"A8g4d55555", o:["ãƒ†ã‚¹ãƒ©", "ã‚·ã‚§ãƒ«ãƒ“ãƒ¼ GT500", "ãƒ•ã‚©ãƒ¼ã‚«ã‚¹", "ãƒã‚¤ãƒ‘ãƒ¼"] }
        ];
    </script>
</body>
</html>